<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attendance of tafsir session</title>
    <style>
      :root {
        font-family: Arial, sans-serif;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #f3f4f6;
        padding: 1rem;
      }
      .app {
        width: min(95vw, 980px);
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
      .panel {
        background: #fff;
        border-radius: 12px;
        padding: 1.25rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      h1 {
        margin-top: 0;
        margin-bottom: 0.75rem;
      }
      .timer {
        background: #eef2ff;
        border: 1px solid #c7d2fe;
        border-radius: 10px;
        padding: 0.85rem;
        margin-bottom: 1rem;
      }
      .timer-label {
        margin: 0;
        color: #4338ca;
        font-size: 0.9rem;
      }
      .timer-value {
        margin: 0.35rem 0 0.7rem;
        font-size: 2rem;
        font-weight: 700;
        color: #312e81;
      }
      .timer-meta {
        margin: 0;
        color: #4b5563;
        font-size: 0.9rem;
      }
      .timer-controls {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.8rem;
      }
      .timer-controls button {
        background: #e0e7ff;
      }
      .row {
        display: flex;
        gap: 0.5rem;
      }
      input {
        flex: 1;
        padding: 0.6rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
      }
      button {
        border: none;
        border-radius: 8px;
        padding: 0.6rem 0.9rem;
        cursor: pointer;
      }
      #add {
        background: #2563eb;
        color: #fff;
      }
      ul {
        list-style: none;
        padding: 0;
        margin: 1rem 0 0;
      }
      li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.55rem 0.6rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 0.5rem;
      }
      li.done span {
        text-decoration: line-through;
        color: #6b7280;
      }
      .actions {
        display: flex;
        gap: 0.35rem;
      }
      .toggle {
        background: #dbeafe;
      }
      .remove {
        background: #fee2e2;
      }
      .empty {
        color: #6b7280;
        margin-top: 0.85rem;
      }
      .speaker-list {
        margin-top: 0.9rem;
        padding-left: 1.1rem;
        color: #4338ca;
      }
      .speaker-list li {
        border: none;
        margin-bottom: 0.25rem;
        padding: 0;
        display: list-item;
      }
    </style>
  </head>
  <body>
    <main class="app">
      <section class="panel" aria-label="Attendance window">
        <h1>Attendance</h1>
        <form id="taskForm" class="row">
          <input id="taskInput" placeholder="Add member name..." />
          <button id="add" type="submit">Add</button>
        </form>
        <p id="empty" class="empty">No members yet.</p>
        <ul id="taskList"></ul>
      </section>

      <section class="panel" aria-label="Speaker timer window">
        <h1>Speaker Stopwatch</h1>
        <section class="timer" aria-label="2 minute speaker timer">
          <p class="timer-label">Count up from 00:00</p>
          <p id="timerValue" class="timer-value">00:00</p>
          <p id="timerMeta" class="timer-meta">Select members to add 2 minutes each.</p>
          <div class="timer-controls">
            <button id="startTimer" type="button">Start</button>
            <button id="pauseTimer" type="button">Pause</button>
            <button id="resetTimer" type="button">Reset</button>
          </div>
        </section>

        <p class="timer-label">Selected speaking order (2 min each)</p>
        <ol id="speakerList" class="speaker-list"></ol>
      </section>
    </main>

    <script>
      const taskForm = document.getElementById('taskForm');
      const taskInput = document.getElementById('taskInput');
      const taskList = document.getElementById('taskList');
      const empty = document.getElementById('empty');
      const timerValue = document.getElementById('timerValue');
      const timerMeta = document.getElementById('timerMeta');
      const speakerList = document.getElementById('speakerList');
      const startTimer = document.getElementById('startTimer');
      const pauseTimer = document.getElementById('pauseTimer');
      const resetTimer = document.getElementById('resetTimer');

      let nextId = 1;
      const tasks = [];
      const speakerQueue = [];

      const SPEAKER_DURATION = 120;
      let secondsElapsed = 0;
      let timerInterval = null;

      function formatTime(totalSeconds) {
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
        const seconds = String(totalSeconds % 60).padStart(2, '0');
        return `${minutes}:${seconds}`;
      }

      function updateTimerDisplay() {
        timerValue.textContent = formatTime(secondsElapsed);

        const totalDuration = speakerQueue.length * SPEAKER_DURATION;
        if (totalDuration === 0) {
          timerMeta.textContent = 'Select members to add 2 minutes each.';
          return;
        }

        const cappedElapsed = Math.min(secondsElapsed, totalDuration);
        const speakerIndex = Math.min(
          Math.floor(cappedElapsed / SPEAKER_DURATION),
          speakerQueue.length - 1
        );
        const currentSpeaker = speakerQueue[speakerIndex];
        const speakerLabel = currentSpeaker ? currentSpeaker.text : 'Finished';

        timerMeta.textContent = `Current: ${speakerLabel} â€¢ ${formatTime(
          cappedElapsed
        )} / ${formatTime(totalDuration)}`;
      }

      function stopTimer() {
        if (!timerInterval) return;
        clearInterval(timerInterval);
        timerInterval = null;
      }

      function startCountdown() {
        const totalDuration = speakerQueue.length * SPEAKER_DURATION;
        if (timerInterval || totalDuration === 0 || secondsElapsed >= totalDuration) return;

        timerInterval = setInterval(() => {
          secondsElapsed += 1;
          updateTimerDisplay();

          if (secondsElapsed >= totalDuration) {
            secondsElapsed = totalDuration;
            updateTimerDisplay();
            stopTimer();
          }
        }, 1000);
      }

      function resetCountdown() {
        stopTimer();
        secondsElapsed = 0;
        updateTimerDisplay();
      }

      startTimer.addEventListener('click', startCountdown);
      pauseTimer.addEventListener('click', stopTimer);
      resetTimer.addEventListener('click', resetCountdown);

      function render() {
        taskList.innerHTML = '';
        speakerList.innerHTML = '';

        tasks.forEach((task) => {
          const li = document.createElement('li');
          li.dataset.id = String(task.id);
          if (task.done) li.classList.add('done');

          const text = document.createElement('span');
          text.textContent = task.text;

          const actions = document.createElement('div');
          actions.className = 'actions';

          const toggle = document.createElement('button');
          toggle.className = 'toggle';
          toggle.type = 'button';
          toggle.dataset.action = 'toggle';
          toggle.textContent = task.done ? 'Undo' : 'Present';

          const remove = document.createElement('button');
          remove.className = 'remove';
          remove.type = 'button';
          remove.dataset.action = 'delete';
          remove.textContent = 'Remove';

          actions.appendChild(toggle);
          actions.appendChild(remove);
          li.appendChild(text);
          li.appendChild(actions);
          taskList.appendChild(li);
        });

        speakerQueue.forEach((speaker) => {
          const li = document.createElement('li');
          li.textContent = speaker.text;
          speakerList.appendChild(li);
        });

        empty.style.display = tasks.length ? 'none' : 'block';
        updateTimerDisplay();
      }

      function addTask() {
        const value = taskInput.value.trim();
        if (!value) return;

        tasks.push({ id: nextId++, text: value, done: false });
        taskInput.value = '';
        taskInput.focus();
        render();
      }

      taskForm.addEventListener('submit', (event) => {
        event.preventDefault();
        addTask();
      });

      taskList.addEventListener('click', (event) => {
        const button = event.target.closest('button[data-action]');
        if (!button) return;

        const li = button.closest('li[data-id]');
        if (!li) return;

        const taskId = Number(li.dataset.id);
        const taskIndex = tasks.findIndex((task) => task.id === taskId);
        if (taskIndex === -1) return;

        if (button.dataset.action === 'toggle') {
          tasks[taskIndex].done = !tasks[taskIndex].done;

          if (tasks[taskIndex].done) {
            speakerQueue.push(tasks[taskIndex]);
          } else {
            const queueIndex = speakerQueue.findIndex((member) => member.id === taskId);
            if (queueIndex !== -1) speakerQueue.splice(queueIndex, 1);
          }
        }

        if (button.dataset.action === 'delete') {
          const queueIndex = speakerQueue.findIndex((member) => member.id === taskId);
          if (queueIndex !== -1) speakerQueue.splice(queueIndex, 1);
          tasks.splice(taskIndex, 1);
        }

        const totalDuration = speakerQueue.length * SPEAKER_DURATION;
        if (secondsElapsed > totalDuration) {
          secondsElapsed = totalDuration;
          stopTimer();
        }

        render();
      });

      updateTimerDisplay();
      render();
    </script>
  </body>
</html>
